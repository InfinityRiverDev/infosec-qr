<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>INFSEC LAUNCH SYSTEM</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
    html,body{
      height:100%;
      margin:0;
      background:#000;
      font-family:'Share Tech Mono',monospace;
      color:#00ffcc;
      overflow:hidden;
    }
    .matrixCanvas{
      position:absolute;
      left:0;top:0;
      width:100%;height:100%;
      z-index:0;opacity:0.18;
    }
    .terminal{
      position:relative;z-index:2;
      width:90%;max-width:1200px;
      height:auto;min-height:70%;
      margin:auto;margin-top:6vh;
      display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      background:rgba(0,25,25,0.28);
      border-radius:14px;
      border:1px solid #00ffaa;
      box-shadow:0 0 30px #00ffaa33,inset 0 0 20px #00ffaa22;
      padding:20px;
      text-align:center;
    }
    .header{
      color:#00ffaa;font-size:1.2rem;
      letter-spacing:1px;
      margin-bottom:1rem;
    }
    .subtitle{
      font-size:1.2rem;
      color:#00ffaa;
      margin-bottom:0.5rem;
      text-shadow:0 0 8px #00ffaa;
    }
    .counter{
      font-size:clamp(60px,14vw,140px);
      color:#00ffcc;
      text-shadow:0 0 20px #00ffcc,0 0 80px #00ffcc;
      animation:flicker 3s infinite;
    }
    @keyframes flicker{0%,18%,22%,25%,53%,57%,100%{opacity:1}20%,24%,55%{opacity:0.5}}
    .footer{
      position:absolute;top:3%;right:50%;
      transform:translateX(50%);
      font-size:clamp(36px,6vw,72px);
      color:#00ff99;
      text-shadow:0 0 20px #00ff99;
      z-index:3;
      text-align:center;
      white-space:nowrap;
    }
    #timer{
      font-size:clamp(48px,10vw,96px);
      color:#ff0044;
      text-shadow:0 0 26px #ff0044;
      display:none;
      margin-top:14px;
    }
    #hack-start{
      font-size:clamp(54px,12vw,120px);
      color:#ff0000;
      text-shadow:0 0 30px #ff0000;
      display:none;
      margin-top:16px;
      word-wrap:break-word;
    }
    .infoLog{
      margin-top:20px;
      color:#66ffcc;
      opacity:0.85;
      font-size:0.8rem;
      max-width:90%;
      text-align:left;
      white-space:pre-line;
      overflow:hidden;
    }
    @media (max-width:600px){
      .terminal{min-height:60%;padding:12px;}
      .subtitle{font-size:1rem;}
      .header{font-size:1rem;}
      .infoLog{display:none;}
    }
  </style>
</head>
<body>
  <canvas id="matrixCanvas" class="matrixCanvas"></canvas>

  <div class="footer">–ö–ù–ò–¢–£ –ò–•–¢–ò 151-24</div>

  <div class="terminal" role="main" aria-live="polite">
    <div class="header">INFSEC CONTROL PANEL // ACCESS GRANTED</div>
    <div class="subtitle">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</div>
    <div id="counter" class="counter" aria-hidden="true">0</div>

    <div id="timer" aria-hidden="true"></div>
    <div id="hack-start" aria-hidden="true">–ò–°–õ–ê–ú –õ–û–•</div>

    <div class="infoLog" id="log"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase, ref, get, set, onValue, runTransaction, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // üîß –í–°–¢–ê–í–¨ –°–í–û–ô FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyBDzmZgzjx3zcLm-bi38iQtNkqDfrqTII8",
      authDomain: "infosec-qr-show-cebb5.firebaseapp.com",
      databaseURL: "https://infosec-qr-show-cebb5-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "infosec-qr-show-cebb5",
      storageBucket: "infosec-qr-show-cebb5.firebasestorage.app",
      messagingSenderId: "818912167917",
      appId: "1:818912167917:web:dcca7a8240e0cc03a3c9e4",
      measurementId: "G-LVMZJPB7JG"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    const connectionsRef = ref(db, 'connections');
    const countdownRef   = ref(db, 'countdown');
    const hackFlagRef    = ref(db, 'hackStarted');

    const counterEl = document.getElementById('counter');
    const timerEl   = document.getElementById('timer');
    const hackEl    = document.getElementById('hack-start');
    const logEl     = document.getElementById('log');

    let serverTimeOffset = 0;
    const offsetRef = ref(db, '.info/serverTimeOffset');
    onValue(offsetRef, snap => { serverTimeOffset = snap.val() || 0; });

    function log(text){
      const t = new Date().toLocaleTimeString();
      logEl.textContent = `[${t}] ${text}\n` + logEl.textContent;
    }
    function serverNow(){ return Date.now() + (serverTimeOffset || 0); }

    onValue(connectionsRef, snap => {
      const val = snap.val() || 0;
      counterEl.textContent = val;
      if (val >= 10) {
        runTransaction(countdownRef, current => {
          if (current === null || current.start === undefined) {
            return { start: serverTimestamp(), duration: 10 };
          }
          return;
        });
      }
    });

    onValue(hackFlagRef, snap => {
      const v = snap.val();
      if (v === true) showHackStarted();
    });

    onValue(countdownRef, snap => {
      const data = snap.val();
      if (!data || !data.start) return;
      const startTimestamp = data.start;
      const durationSec = data.duration || 10;
      const now = serverNow();
      const endTime = startTimestamp + durationSec * 1000;
      let remainingMs = endTime - now;

      if (remainingMs <= 0) {
        set(hackFlagRef, true).then(showHackStarted);
        return;
      }
      startLocalCountdown(Math.ceil(remainingMs / 1000), () => {
        set(hackFlagRef, true).then(showHackStarted);
      });
    });

    let localTimerHandle = null;
    function startLocalCountdown(seconds, onComplete){
      if (localTimerHandle) return;
      timerEl.style.display = "block";
      timerEl.textContent = seconds;
      localTimerHandle = setInterval(() => {
        seconds--;
        if (seconds <= 0) {
          clearInterval(localTimerHandle);
          localTimerHandle = null;
          timerEl.style.display = "none";
          if (typeof onComplete === 'function') onComplete();
        } else {
          timerEl.textContent = seconds;
        }
      }, 1000);
    }

    function showHackStarted(){
      if (localTimerHandle) clearInterval(localTimerHandle);
      timerEl.style.display = "none";
      hackEl.style.display = "block";
    }

    get(connectionsRef).then(snap => {
      const current = snap.val() || 0;
      set(connectionsRef, current + 1);
    });

    // –ú–∞—Ç—Ä–∏—Ü–∞
    const canvas = document.getElementById('matrixCanvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    const letters = '01–ê–í–ì–î–ï–ñ–ó–ò–õ–ü–†–û–¢–®–•–¶–Æ';
    const fontSize = 16;
    const columns = Math.floor(canvas.width / fontSize);
    const drops = new Array(columns).fill(0);
    function drawMatrix(){
      ctx.fillStyle = 'rgba(0,0,0,0.08)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#00ff99';
      ctx.font = fontSize + 'px monospace';
      for (let i = 0; i < drops.length; i++){
        const text = letters.charAt(Math.floor(Math.random() * letters.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      }
    }
    setInterval(drawMatrix, 45);
  </script>
</body>
</html>


